{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link href="{% static 'libs/sweetalert2/dist/sweetalert2.min.css' %}" rel="stylesheet" type="text/css" />

<!-- DataTables -->
<link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet"
    type="text/css" />
<link href="{% static 'libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css' %}" rel="stylesheet"
    type="text/css" />

<!-- Responsive datatable examples -->
<link href="{% static 'libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet"
    type="text/css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">{% endblock %}

{% block contents %}

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="card-body p-0">
                    <form id="myForm" method='GET' class="needs-validation" autocomplete="off"  novalidate>
                        <div class="row justify-content-end" style="margin-right: 0px;" >
                            <div class="col-md-4">  
                                <div class="input-group mb-3">
                                    <select  class="form-select select2"  placeholder="Choose Order Status" id="call_group" name='call_group' >      
                                        <option value="">Choose Call Disposition Group</option>
                                        <option value="2" {% if request.GET.call_group == '2' %}selected{% endif %}>Retry</option>                                        
                                    </select>
                                </div>   
                            </div> 
                            <div class="col-md-4">  
                                <div class="input-group mb-3">
                                    <input type="text" id="search" name="search" class="form-control" value="{{ search }}" placeholder="Name or Unique ID">
                                </div>   
                            </div>
                            <div class="col-auto p-0">
                                <button type="submit" class="btn btn-success"><i class="fa fa-search" aria-hidden="true" title="Search"></i></button>
                                <button type="reset" id="filter_reset" class="btn btn-outline-warning waves-effect btn-xs float-right"><i class="mdi mdi-refresh" title="Reset Filter"></i></button>
                            </div>
                        </div>
                    </form>
                    <div class="table-responsive mb-3" data-pattern="priority-columns">
                        <table id="datatable-buttons" class="table table-striped dt-responsive mb-0 mt-3">
                            <thead class="table-light">
                                <tr>
                                    <th>S No</th>
                                    <th>Unique Id</th>
                                    <th>Name</th>   
                                    <th>Age</th>  
                                    <th>Gender</th> 
                                    <th>Contact No(+91)</th>   
                                    <th>Camp/VC Name</th>
                                    <th>Type of Job</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for l in data %}
                                <tr>
                                    <td>{{forloop.counter0|add:data.start_index }}</td>
                                    <td>{{l.unique_id}}</td>
                                    <td>{{l.name|default_if_none:'-'}}</td>
                                    <td>{{l.age|default_if_none:'-'}}</td>
                                    <td>{{l.get_gender_display|default_if_none:'-'}}</td>
                                    <td>{{l.contact_no_1|default_if_none:'-'}}</td>
                                    <td>{% if l.camp %}{{l.camp|default_if_none:'-'}} {% else %} {{l.get_vision_center|default_if_none:'-'}} {% endif %} </td>
                                    <td>{{l.type_of_job|default_if_none:'-'}}</td>
                                    <td> 
                                        {% if request.session.role_id == 7 %}
                                            {% if l.get_catract_questions %}
                                            <button type="submit" id="submitting" style="margin-left: 5px;" class="btn btn-success w-md"
                                                onclick="location.href='/cataract-details/{{ l.uuid }}/?page={{page}}'">
                                                View Feedback
                                            </button>
                                            {% else %}
                                            <button type="submit" id="submitting" style="margin-left: 5px;" class="btn btn-primary w-md"
                                                onclick="location.href='/cataract-details/{{ l.uuid }}/?page={{page}}'">
                                                Add Feedback
                                            </button>
                                            {% endif %}
                                        {% else %}
                                            {% if l.get_catract_questions %}
                                            <button type="submit" id="submitting" style="margin-left: 5px;" class="btn btn-success waves-effect"
                                                onclick="location.href='/cataract-details/{{ l.uuid }}/?page={{page}}'">
                                                View Feedback
                                            </button>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                        
                    <nav aria-label="...">
                        {% if data.has_other_pages %}
                        <ul class="pagination justify-content-end ">
                            {% if data.has_previous %}
                            <li class="paginate_button page-item"><a class="page-link" href="?page=1&search={{search}}">First</a></li>
                            {% else %}
                            <li class="paginate_button page-item disabled"><span class="page-link">First</span></li>
                            {% endif %}
                            {% for i in display_page_range %}
                                {% if data.number == i %}
                                <li class="page-item active"><span class="page-link">{{ i }} <span class="sr-only">(current)</span></span></li>
                                {% else %}
                                <li class="paginate_button paginate_button page-item"><a class="page-link" href="?page={{ i }}&search={{search}}">{{ i }}</a></li>
                                {% endif %}
                            {% endfor %}
                            {% if data.has_next %}
                                <li class="paginate_button page-item"><a class="page-link" href="?page={{ data.paginator.num_pages }}&search={{search}}">Last</a></li>
                            {% else %}
                                <li class="paginate_button page-item disabled"><span class="page-link">Last</span></li>
                            {% endif %}
                            </ul>
                        {% endif %}
                    </nav> 
                </div> 
            </div> 
        </div>
    </div>                        
</div>

{% endblock %}
{% block extra_javascript %}
<script src="{% static 'libs/sweetalert2/dist/sweetalert2.min.js' %}"></script>

<!-- Required datatable js -->
<script src="{% static 'libs/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<!-- <script src="{% static 'libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js' %}"></script> -->
<!-- Buttons examples -->
<script src="{% static 'libs/datatables.net-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-buttons/js/buttons.colVis.min.js' %}"></script>

<!-- Responsive examples -->
<script src="{% static 'libs/datatables.net-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src="{% static 'libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js' %}"></script>

<!-- Datatable init js -->
<script src="{% static 'js/pages/datatables.init.js' %}"></script>
<script type="text/javascript">
    $('#filter_reset').click(function() {
        $('#search').val('');
        $('#call_group').val('');

        this.form.submit();
  });
    
</script>

{% endblock %}