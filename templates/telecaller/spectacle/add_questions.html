{% extends 'base.html' %}
{% load static %}
{% block extra_css %}
<link href="{% static 'libs/sweetalert2/dist/sweetalert2.min.css' %}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block contents %}
{% if not spectacle_details.get_glass_questions or telecalling_call_group %}
                                                
<div class="row align-items-center">
    <div class="col-xl-12 mx-auto">
        <div class="card">
            <div class="card-body">  
                <div class="tab-content" id="myTabContent">
                    <div class="table-responsive" >								
                        <table  class="table  dt-responsive ">
                            <thead class="table-light">
                                <tr>
                                    <th colspan="4">Patient Info - ({{spectacle_details.name|default_if_none:'-'}})</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th>Unique Id</th>
                                    <td>{{spectacle_details.unique_id}}</td>
                                    <th>Name</th>
                                    <td>{{spectacle_details.name|default_if_none:'-'}}</td>   
                                </tr>
                                <tr> 
                                    <th>Occupation</th>
                                    <td>{{spectacle_details.type_of_job|default_if_none:'-'}}</td>   
                                    <th>Age</th>
                                    <td>{{spectacle_details.age|default_if_none:'-'}}</td>
                                </tr>
                                <tr>   
                                    <th>Sex</th>
                                    <td>{{spectacle_details.get_gender_display|default_if_none:'-'}}</td>
                                    <th>Contact No</th>
                                    <td>{{spectacle_details.contact_no_1|default_if_none:'-'}}</td>
                                </tr>
                                <tr>
                                    {% if spectacle_details.camp %}
                                    <th>Camp Name</th>
                                    <td>{{spectacle_details.camp|default_if_none:'-'}}</td>
                                    <th>Camp Date</th>
                                    <td>{{spectacle_details.camp.date|default_if_none:'-'}} </td>
                                    {% else %}
                                    <th>Vision Center</th>
                                    <td>{{spectacle_details.get_vision_center|default_if_none:'-'}}</td>
                                        <th>Hospital Name</th>
                                        <td>{{spectacle_details.get_vision_center.partner.name|default_if_none:'-'}} </td>
                                    {% endif %}
                                </tr>
                                <tr>
                                    <th>Glass Status</th>
                                    <td>{{spectacles.get_spectacle_status_display|default_if_none:'-'}}</td> 
                                    <th>Screened Location</th>
                                    <td>{% if spectacle_details.camp %}{{spectacle_details.camp.location|default_if_none:'-'}}{% else %}{{spectacle_details.get_vision_center.address|default_if_none:'-'}}{% endif %}</td>
                                </tr>
                                <tr>
                                    <th>Delivery By</th>
                                    <td>{{spectacle_details.user|default_if_none:'-'}} </td>
                                    <th>Type of Refractive </br> Error Identified </th>
                                    <td>{{visual_acuity.treatment_for_refraction|default_if_none:'-'}} </td>
                                </tr>
                                <tr>
                                    <th>R2C Remarks</th>
                                    <td>{{spectacle_details.drivers_license_no|default_if_none:'-'}} </td>
                                    <th>Spectacle Type</th>
                                    <td>{{glass_pres.spectacle_type|default_if_none:'-'}}</td>
                                </tr>
                                {% if spectacle_details.camp %}
                                <tr>
                                    <th>Hospital Name</th>
                                    <td>{{spectacle_details.get_vision_center.partner.name|default_if_none:'-'}} </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                    <div class="table-responsive">
                        <table  class="table  dt-responsive ">
                            <thead class="table-light">
                                <th>
                                    Patient Feedback                            
                                </th>
                            </thead>
                        </table>
                    </div>
                    <form  id="myForm" method="POST" class="needs-validation" novalidate>
                        {% csrf_token %}
                        <div class='text-danger'>
                            {{error}}
                        </div> 
                        <div class="mb-3 mt-4">
                            <label class="d-block mb-3"><b>Have you received your Spectacles ?</b></label>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="yes_no1" id="yes_radio" value="1" {% if telecalling.receive_your_spectacles == 1 %} checked {% endif %}>
                                <label class="form-check-label" for="inlineRadio1">Yes</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="yes_no1" id="no_radio" value="2" {% if telecalling.receive_your_spectacles == 2 %} checked {% endif %}>
                                <label class="form-check-label" for="inlineRadio2">No</label>
                            </div>                                                          
                        </div>
                        
                        <div id="second_form_wrapper" style="display: none;">
                            <label for="yes_no_radio"><b>If no, please provide reason</b></label>
                            <div class="col-md-4 mt-2">
                                <input type="text" class="form-control" name="reason" placeholder="Please enter reason" value="">
                            </div> 
                        </div>
                        
                        <div id="yes_selection" style="display: none;">
                            <div class="row mb-4 mt-4">
                                <label for="yes_no_radio"><b>After how many days of screening you received spectacles and where ? </b></label>
                                <div class="col-md-4 mt-2">
                                    <input type="text" class="form-control" name='how_many_days' placeholder="Enter Days and location" value="{{telecalling.ahmd_spectacles_received|default_if_none:'-'}}" >
                                </div>                              
                            </div>
                            
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Are you currently using the spectacles ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no2" value="1" {% if telecalling.currently_using_spectacles == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no2" value="2" {% if telecalling.currently_using_spectacles == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Are you satisfied with the quality of spectacle provided ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no3" value="1" {% if telecalling.satisfied_with_spectacle == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no3" value="2" {% if telecalling.satisfied_with_spectacle == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Any problems raised before after receiving spectacles or in centre ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no4" value="1" {% if telecalling.any_problems_raised == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no4" value="2" {% if telecalling.any_problems_raised == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Is there any impact on their driving after wearing glasses ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no8" value="1" {% if telecalling.any_problems_raised == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no8" value="2" {% if telecalling.any_problems_raised == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Are you satisfied with our service ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no5" value="1" {% if telecalling.satisfied_with_our_service == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no5" value="2" {% if telecalling.satisfied_with_our_service == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>Was there any charges while collecting the spectacles ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no6" value="1" {% if telecalling.any_charges_while_collecting == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">Yes</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no6" value="2" {% if telecalling.any_charges_while_collecting == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">No</label>
                                </div>                                                          
                            </div>
                            <div class="mb-3">
                                <label class="d-block mb-3"><b>How much would you rate our services (Beale out of 1-5) or How was our services ?</b></label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no7" value="1" {% if telecalling.rate_our_services == 1 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">1-Excellent</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no7" value="2" {% if telecalling.rate_our_services == 2 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">2-Good</label>
                                </div>   
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no7" value="3" {% if telecalling.rate_our_services == 3 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio1">3-Not so good</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no7" value="4" {% if telecalling.rate_our_services == 4 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">4-Bad</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="yes_no7" value="5" {% if telecalling.rate_our_services == 5 %} checked {% endif %}>
                                    <label class="form-check-label" for="inlineRadio2">5-Very Bad</label>
                                </div> 
                            </div>
                        </div>
                        <br>
                        <div class="table-responsive">
                            <table  class="table  dt-responsive ">
                                <thead class="table-light">
                                    <th>
                                    Comment Area
                                </th>
                                </thead>
                            </table>
                        </div>
                        <div class="row md-4 mt-4">
                            <label for="" class="col-md-2 col-form-label">Ad<span class="required-field"></span></label>
                            <div class="col-md-4">
                                <textarea type="text" name= "ad" rows="4" cols="50" class="form-control" required placeholder="Enter Ad">{{ telecalling.ad }}</textarea>
                                <div class="invalid-feedback">
                                    Please Enter Ad.
                                </div>
                            </div>
                            <label for="" class="col-md-2 col-form-label">Disposition Name<span class="required-field"></span></label>
                            <div class="col-md-4">
                                <select name="disposition_name" class="form-select" required>
                                    <option value="" selected >Select Disposition Name</option>
                                    {% for disposition in disposition_choices %}
                                        <option value="{{ disposition.id }}" {% if disposition.id == telecalling.disposition_name.id %}selected{% endif %}>{{ disposition }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">
                                    Please Enter Disposition Name.
                                </div>
                            </div>           
                        </div> 
                        <div class="row md-4 mt-4">
                            <label for="" class="col-md-2 col-form-label">Call Disposition Group<span class="required-field"></span></label>
                                <div class="col-md-4">
                                    <select name="call_disposition_group"  class="form-select" required>
                                        <option value="" selected>Select Call Disposition Group</option>
                                        <option value="1" {% if telecalling.call_disposition_group == 1 %}selected{% endif %}>Complaint</option>
                                        <option value="2" {% if telecalling.call_disposition_group == 2 %}selected{% endif %}>Retry</option>
                                        <option value="3" {% if telecalling.call_disposition_group == 3 %}selected{% endif %}>Successful</option>
                                        <option value="4" {% if telecalling.call_disposition_group == 4 %}selected{% endif %}>UnSuccessful</option>
                                        <option value="5" {% if telecalling.call_disposition_group == 5 %}selected{% endif %}>Spectacle out of stock</option>
                                    </select>
                                    <div class="invalid-feedback">
                                        Please Enter Call Disposition Group.
                                    </div>
                                </div> 
                                <label for="" class="col-md-2 col-form-label">Comments<span class="required-field"></span></label>
                            <div class="col-md-4">
                                <select name="comments" class="form-select" required>
                                    <option value="">Select Comments</option>
                                    {% for comment in comments_choices %}
                                        <option value="{{ comment.id }}" {% if comment.id == telecalling.comments.id %}selected{% endif %}>{{ comment }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">
                                    Please Enter Comments .
                                </div>
                            </div>
                        </div>
                        <div class="row md-4 mt-4">
                            <label for="" class="col-md-2 col-form-label">Agent Comments</label>
                            <div class="col-md-4">
                                <textarea type="text" name= "agent_comments" rows="4" cols="50" class="form-control"  placeholder="Enter Agent Comments" >{{ telecalling.agent_comments }}</textarea>
                            </div>
                        </div>
                        
                        <div class="gap-2" style="float:right;">
                            <button type="reset"  onclick="location.href='javascript:history.back()'" class="btn btn-secondary waves-effect">
                                Cancel
                            </button>
                            <button type="submit" id="submitting" style="margin-left: 5px;" class="btn btn-primary w-md">Submit</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
 {% else %}
 <div class="row align-items-center">
    <div class="col-xl-12 mx-auto">
        <div class="card">
            <div class="card-body">  
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                        <div class="table-responsive" >								
                            <table  class="table  dt-responsive ">
                                <thead class="table-light">
                                    <tr>
                                        <th colspan="4">Patient Info - ({{spectacle_details.name|default_if_none:'-'}})</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <th>Unique Id</th>
                                        <td>{{spectacle_details.unique_id}}</td> 
                                        <th>Name</th>
                                        <td>{{spectacle_details.name|default_if_none:'-'}}</td>   
                                    </tr>
                                    <tr> 
                                        <th>Occupation</th>
                                        <td>{{spectacle_details.type_of_job|default_if_none:'-'}}</td>   
                                        <th>Age</th>
                                        <td>{{spectacle_details.age|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>   
                                        <th>Sex</th>
                                        <td>{{spectacle_details.get_gender_display|default_if_none:'-'}}</td>
                                        <th>Contact No</th>
                                        <td>{{spectacle_details.contact_no_1|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        {% if spectacle_details.camp %}
                                        <th>Camp Name</th>
                                        <td>{{spectacle_details.camp|default_if_none:'-'}}</td>
                                        <th>Camp Date</th>
                                        <td>{{spectacle_details.camp.date|default_if_none:'-'}} </td>
                                        {% else %}
                                        <th>Vision Center</th>
                                        <td>{{spectacle_details.get_vision_center|default_if_none:'-'}}</td>
                                        <th>Hospital Name</th>
                                        <td>{{spectacle_details.get_vision_center.partner.name|default_if_none:'-'}} </td>
                                        {% endif %}
                                    </tr>
                                    <tr>
                                        <th>Glass Status</th>
                                        <td>{{spectacles.get_spectacle_status_display|default_if_none:'-'}}</td> 
                                        <th>Screened Location</th>
                                        <td>{% if spectacle_details.camp %}{{spectacle_details.camp.location|default_if_none:'-'}}{% else %}{{spectacle_details.get_vision_center.address|default_if_none:'-'}}{% endif %}</td>
                                    </tr>
                                    <tr>
                                        <th>Delivery By</th>
                                        <td>{{spectacle_details.user|default_if_none:'-'}} </td>
                                        <th>Type of Refractive </br> Error Identified </th>
                                        <td>{{visual_acuity.treatment_for_refraction|default_if_none:'-'}} </td>
                                    </tr>
                                    <tr>
                                        <th>R2C Remarks</th>
                                        <td>{{spectacle_details.drivers_license_no|default_if_none:'-'}} </td>
                                        <th>Spectacle Type</th>
                                        <td>{{glass_pres.spectacle_type|default_if_none:'-'}}</td>
                                    </tr>
                                    {% if spectacle_details.camp %}
                                    <tr>
                                        <th>Hospital Name</th>
                                        <td>{{spectacle_details.get_vision_center.partner.name|default_if_none:'-'}} </td>
                                    </tr>
                                    {% endif %}
                                    <td colspan="4" ></td>
                                    <thead class="table-light">
                                        <tr>
                                            <th colspan="4" >Patient Feedback</th>
                                        </tr>
                                    </thead>
                                    <tr>
                                        <th colspan="3">Have you receive your Spectacles ?</th>
                                        <td colspan="2">{{telecalling.get_receive_your_spectacles_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">If no, please provide reason</th>
                                        <td colspan="2">{{telecalling.receiver_spectacles_reason|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">After how many days of screening you received spectacles and where </th>
                                        <td colspan="2">{{telecalling.ahmd_spectacles_received|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Are you currently using the spectacles </th>
                                        <td colspan="2">{{telecalling.get_currently_using_spectacles_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Are you satisfied with the quality of spectacle provided </th>
                                        <td colspan="2">{{telecalling.get_satisfied_with_spectacle_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Any problems raised before after receiving spectacles or in centre</th>
                                        <td colspan="2">{{telecalling.get_any_problems_raised_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Are you satisfied with our service</th>
                                        <td colspan="2">{{telecalling.get_satisfied_with_our_service_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Was there any charges while collecting the spectacles</th>
                                        <td colspan="2">{{telecalling.get_any_charges_while_collecting_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">How much would you rate our services (Beale out of 1-5)</th>
                                        <td colspan="2">{{telecalling.get_rate_our_services_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <td colspan="4"></td>
                                    <thead class="table-light">
                                        <tr>
                                            <th colspan="4">
                                                Comment Area
                                            </th>
                                        </tr>
                                    </thead>
                                    <tr>
                                        <th colspan="3">Ad</th>
                                        <td colspan="2">{{telecalling.ad|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Disposition Name</th>
                                        <td colspan="2">{{telecalling.disposition_name|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Call Disposition Group</th>
                                        <td colspan="2">{{telecalling.get_call_disposition_group_display|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Comments</th>
                                        <td colspan="2">{{telecalling.comments|default_if_none:'-'}}</td>
                                    </tr>
                                    <tr>
                                        <th colspan="3">Agent Comments</th>
                                        <td colspan="2">{{telecalling.agent_comments|default_if_none:'-'}}</td>
                                    </tr>
                                </tbody>
                            </table> 
                        </div> 
                    </div>   
                </div>
                <div class="gap-2">
                    <button type="reset"  onclick="location.href='javascript:history.back()'" class="btn btn-secondary waves-effect">
                        Back
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>  
{% endif %}

<script>
    
    const yesRadio = document.getElementById('yes_radio');
    const noRadio = document.getElementById('no_radio');
    const secondFormWrapper = document.getElementById('second_form_wrapper');

    function toggleSecondForm() {
        secondFormWrapper.style.display = noRadio.checked ? 'block' : 'none';
    }

    yesRadio.addEventListener('change', toggleSecondForm);
    noRadio.addEventListener('change', toggleSecondForm);

    toggleSecondForm();
</script>
<script>
    function toggleSections() {
        var yesRadio = document.getElementById('yes_radio');
        var noRadio = document.getElementById('no_radio');
        var reasonDiv = document.getElementById('second_form_wrapper');
        
        var visitedDiv = document.getElementById('yes_selection');

        if (yesRadio.checked) {
            reasonDiv.style.display = 'none';
            visitedDiv.style.display = 'block';
        } else if (noRadio.checked) {
            reasonDiv.style.display = 'block';
            visitedDiv.style.display = 'none';
        }
    }

    var yesRadio1 = document.getElementById('yes_radio');
    var noRadio1 = document.getElementById('no_radio');

    yesRadio1.addEventListener('change', toggleSections);
    noRadio1.addEventListener('change', toggleSections);

    toggleSections();
</script>

<script>
    function validateForm() {
        var form = document.getElementById('myForm');

        if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
        }
        form.classList.add('was-validated');
    }

    document.getElementById('submitting').addEventListener('click', validateForm);
 
</script>

{% endblock %}
